<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>SAGE - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>SAGE - Dashboard de Equipamentos</h1>
    </div>

    <h3>Status dos Equipamentos</h3>
    <table class="table table-hover">
        <thead class="table-light">
        <tr>
            <th>Patrimônio</th>
            <th>Tipo</th>
            <th>Localização</th>
            <th>Status</th>
            <th>Ações</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="equip : ${equipamentos}">
            <td th:text="${equip.patrimonio}">NC-12345</td>
            <td th:text="${equip.tipo}">Bomba de Infusão</td>
            <td th:text="${equip.localizacao}">UTI - Leito 01</td>
            <td>
                <span th:text="${equip.status.name()}"
                      th:classappend="${equip.status.name() == 'OPERACIONAL' ? 'badge bg-success' : (equip.status.name() == 'EM_MANUTENCAO' ? 'badge bg-warning' : 'badge bg-secondary')}">
                </span>
            </td>
            <td>
                <a th:if="${equip.status.name() == 'OPERACIONAL'}"
                   th:href="@{/os/nova/{id}(id=${equip.id})}"
                   class="btn btn-primary btn-sm">Abrir O.S.</a>
            </td>
        </tr>
        </tbody>
    </table>

    <hr class="my-5">

    <h3>Ordens de Serviço</h3>
    <table class="table table-hover">
        <thead class="table-light">
        <tr>
            <th>ID</th>
            <th>Equipamento (Patrimônio)</th>
            <th>Problema</th>
            <th>Prioridade</th>
            <th>Status</th>
            <th>Ações</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="os : ${ordensServico}">
            <td th:text="${#strings.substring(os.id, 0, 8)}">...</td>
            <td th:text="${equipamentoMap[os.equipamentoId]?.patrimonio}">
                NC-12345
            </td>
            <td th:text="${os.descricaoProblema}">Não liga</td>
            <td th:text="${os.prioridade.name()}">ALTA</td>
            <td>
                 <span th:text="${os.status.name()}"
                       th:classappend="${os.status.name() == 'ABERTA' ? 'badge bg-danger' : (os.status.name() == 'FECHADA' ? 'badge bg-info' : 'badge bg-light')}">
                </span>
            </td>
            <td>
                <form th:if="${os.status.name() == 'ABERTA'}" th:action="@{/os/fechar/{id}(id=${os.id})}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-success btn-sm">Fechar O.S.</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>